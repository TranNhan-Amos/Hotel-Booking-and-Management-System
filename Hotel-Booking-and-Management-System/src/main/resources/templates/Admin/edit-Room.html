<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin KS - Chỉnh sửa phòng</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 50%, #4f46e5 100%);
        }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        }
        
        .form-input {
            transition: all 0.3s ease;
        }
        
        .form-input:focus {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.15);
        }
        
        .image-preview {
            transition: all 0.3s ease;
        }
        
        .image-preview:hover {
            transform: scale(1.05);
        }
        
        .delete-btn {
            transition: all 0.2s ease;
        }
        
        .delete-btn:hover {
            transform: scale(1.1);
        }
        
        .custom-file-input {
            position: relative;
            display: inline-block;
            cursor: pointer;
        }
        
        .custom-file-input input[type=file] {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }
        
        .file-upload-area {
            border: 2px dashed #d1d5db;
            border-radius: 12px;
            padding: 2rem;
            text-align: center;
            transition: all 0.3s ease;
            background: #f9fafb;
        }
        
        .file-upload-area:hover {
            border-color: #8b5cf6;
            background: #f3f4f6;
        }
        
        .file-upload-area.dragover {
            border-color: #8b5cf6;
            background: #f0f9ff;
        }
    </style>
</head>
<body class="min-h-screen bg-gray-50">
    <!-- Header Navigation -->
    <div th:replace="~{/Layout/NavbarAdmin}"></div>

    <!-- Main Content -->
    <main class="p-6">
        <div class="max-w-7xl mx-auto">
            <!-- Page Header -->
            <div class="gradient-bg text-white p-6 rounded-2xl shadow-xl mb-6">
                <div class="flex items-center space-x-4">
                    <div class="bg-white/20 p-3 rounded-xl">
                        <i data-lucide="edit-3" class="w-8 h-8"></i>
                    </div>
                    <div>
                        <h1 class="text-3xl font-bold">Chỉnh sửa phòng</h1>
                        <p class="text-purple-100">Cập nhật thông tin phòng khách sạn</p>
                    </div>
                </div>
            </div>

            <!-- Edit Form -->
            <div class="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden">
                <form th:action="@{/admin/rooms/save}" method="post" enctype="multipart/form-data" class="p-6">
                    <input type="hidden" name="roomId" th:value="${room != null ? room.roomId : ''}" />
                    <input type="hidden" name="partner.id" th:value="${selectedPartnerId}" />
                    
                    <!-- Two Column Layout -->
                    <div class="grid grid-cols-1 xl:grid-cols-2 gap-8">
                        <!-- Left Column - Form Fields -->
                        <div class="space-y-6">
                            <!-- Basic Information -->
                            <div class="bg-gray-50 p-6 rounded-xl">
                                <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                                    <i data-lucide="info" class="w-5 h-5 mr-2"></i>
                                    Thông tin cơ bản
                                </h3>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label for="nameNumber" class="block text-sm font-medium text-gray-700 mb-2">
                                            Tên phòng <span class="text-red-500">*</span>
                                        </label>
                                        <input type="text" id="nameNumber" name="nameNumber" 
                                               th:value="${room != null ? room.nameNumber : ''}" 
                                               placeholder="VD: Phòng Deluxe Ocean View"
                                               class="w-full px-3 py-2 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none form-input"
                                               required />
                                    </div>
                                    
                                    <div>
                                        <label for="roomNumber" class="block text-sm font-medium text-gray-700 mb-2">
                                            Mã phòng
                                        </label>
                                        <input type="text" id="roomNumber" name="roomNumber" 
                                               th:value="${room != null ? room.roomNumber : ''}" 
                                               placeholder="VD: A101"
                                               class="w-full px-3 py-2 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none form-input" />
                                    </div>
                                    
                                    <div>
                                        <label for="price" class="block text-sm font-medium text-gray-700 mb-2">
                                            Giá phòng (VNĐ) <span class="text-red-500">*</span>
                                        </label>
                                        <input type="number" id="price" name="price" 
                                               th:value="${room != null ? room.price : ''}" 
                                               placeholder="VD: 2500000" min="0" step="100000" required
                                               class="w-full px-3 py-2 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none form-input" />
                                    </div>
                                    
                                    <div>
                                        <label for="capacity" class="block text-sm font-medium text-gray-700 mb-2">
                                            Sức chứa (người) <span class="text-red-500">*</span>
                                        </label>
                                        <input type="number" id="capacity" name="capacity" 
                                               th:value="${room != null ? room.capacity : ''}" 
                                               placeholder="VD: 2" min="1" max="10" required
                                               class="w-full px-3 py-2 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none form-input" />
                                    </div>
                                </div>
                            </div>

                            <!-- Room Details -->
                            <div class="bg-gray-50 p-6 rounded-xl">
                                <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                                    <i data-lucide="settings" class="w-5 h-5 mr-2"></i>
                                    Chi tiết phòng
                                </h3>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label for="type" class="block text-sm font-medium text-gray-700 mb-2">
                                            Loại phòng <span class="text-red-500">*</span>
                                        </label>
                                        <select id="type" name="type" required
                                                class="w-full px-3 py-2 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none form-input">
                                            <option value="">-- Chọn loại phòng --</option>
                                            <option th:each="roomType : ${T(sd19303no1.hotel_booking_and_management_system.Entity.RoomEntity.RoomType).values()}"
                                                    th:value="${roomType}"
                                                    th:text="${roomType.description}"
                                                    th:selected="${room != null and room.type != null and room.type.name() == roomType.name()}">
                                            </option>
                                        </select>
                                    </div>
                                    
                                    <div>
                                        <label for="status" class="block text-sm font-medium text-gray-700 mb-2">
                                            Trạng thái <span class="text-red-500">*</span>
                                        </label>
                                        <select id="status" name="status" required
                                                class="w-full px-3 py-2 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none form-input">
                                            <option value="">-- Chọn trạng thái --</option>
                                            <option th:each="status : ${T(sd19303no1.hotel_booking_and_management_system.Entity.RoomEntity.RoomStatus).values()}"
                                                    th:value="${status}"
                                                    th:text="${status.description}"
                                                    th:selected="${room != null and room.status != null and room.status.name() == status.name()}">
                                            </option>
                                        </select>
                                    </div>
                                    
                                    <div>
                                        <label for="totalRooms" class="block text-sm font-medium text-gray-700 mb-2">
                                            Tổng số phòng <span class="text-red-500">*</span>
                                        </label>
                                        <input type="number" id="totalRooms" name="totalRooms" 
                                               th:value="${room != null ? room.totalRooms : ''}" 
                                               placeholder="VD: 10" min="1" required
                                               class="w-full px-3 py-2 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none form-input" />
                                    </div>
                                    
                                    <div>
                                        <label for="bedType" class="block text-sm font-medium text-gray-700 mb-2">
                                            Loại giường
                                        </label>
                                        <select id="bedType" name="bedType"
                                                class="w-full px-3 py-2 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none form-input">
                                            <option value="">-- Chọn loại giường --</option>
                                            <option th:each="bedType : ${T(sd19303no1.hotel_booking_and_management_system.Entity.RoomEntity.BedType).values()}"
                                                    th:value="${bedType}"
                                                    th:text="${bedType.description}"
                                                    th:selected="${room != null and room.bedType != null and room.bedType.name() == bedType.name()}">
                                            </option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <!-- Additional Details -->
                            <div class="bg-gray-50 p-6 rounded-xl">
                                <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                                    <i data-lucide="plus-circle" class="w-5 h-5 mr-2"></i>
                                    Thông tin bổ sung
                                </h3>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label for="bathroomType" class="block text-sm font-medium text-gray-700 mb-2">
                                            Loại phòng tắm
                                        </label>
                                        <select id="bathroomType" name="bathroomType"
                                                class="w-full px-3 py-2 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none form-input">
                                            <option value="">-- Chọn loại phòng tắm --</option>
                                            <option th:each="bathroomType : ${T(sd19303no1.hotel_booking_and_management_system.Entity.RoomEntity.BathroomType).values()}"
                                                    th:value="${bathroomType}"
                                                    th:text="${bathroomType.description}"
                                                    th:selected="${room != null and room.bathroomType != null and room.bathroomType.name() == bathroomType.name()}">
                                            </option>
                                        </select>
                                    </div>
                                    
                                    <div>
                                        <label for="view" class="block text-sm font-medium text-gray-700 mb-2">
                                            Hướng nhìn
                                        </label>
                                        <select id="view" name="view"
                                                class="w-full px-3 py-2 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none form-input">
                                            <option value="">-- Chọn hướng nhìn --</option>
                                            <option th:each="viewType : ${T(sd19303no1.hotel_booking_and_management_system.Entity.RoomEntity.ViewType).values()}"
                                                    th:value="${viewType}"
                                                    th:text="${viewType.description}"
                                                    th:selected="${room != null and room.view != null and room.view.name() == viewType.name()}">
                                            </option>
                                        </select>
                                    </div>
                                    
                                    <div>
                                        <label for="isSmoking" class="block text-sm font-medium text-gray-700 mb-2">
                                            Cho phép hút thuốc
                                        </label>
                                        <select id="isSmoking" name="isSmoking"
                                                class="w-full px-3 py-2 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none form-input">
                                            <option value="false" th:selected="${room == null || room.isSmoking == false}">Không</option>
                                            <option value="true" th:selected="${room != null && room.isSmoking == true}">Có</option>
                                        </select>
                                    </div>
                                    
                                    <div>
                                        <label for="isPetFriendly" class="block text-sm font-medium text-gray-700 mb-2">
                                            Cho phép thú cưng
                                        </label>
                                        <select id="isPetFriendly" name="isPetFriendly"
                                                class="w-full px-3 py-2 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none form-input">
                                            <option value="false" th:selected="${room == null || room.isPetFriendly == false}">Không</option>
                                            <option value="true" th:selected="${room != null && room.isPetFriendly == true}">Có</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <!-- Descriptions -->
                            <div class="bg-gray-50 p-6 rounded-xl">
                                <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                                    <i data-lucide="file-text" class="w-5 h-5 mr-2"></i>
                                    Mô tả
                                </h3>
                                
                                <div class="space-y-4">
                                    <div>
                                        <label for="service" class="block text-sm font-medium text-gray-700 mb-2">
                                            Dịch vụ
                                        </label>
                                        <textarea id="service" name="service" rows="3" 
                                                  th:text="${room != null ? room.service : ''}" 
                                                  placeholder="Mô tả các dịch vụ có sẵn như: bữa sáng tự chọn, xe đưa đón, bãi đậu xe, nhân viên hỗ trợ..."
                                                  class="w-full px-3 py-2 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none form-input resize-none"></textarea>
                                    </div>
                                    
                                    <div>
                                        <label for="description" class="block text-sm font-medium text-gray-700 mb-2">
                                            Mô tả chi tiết
                                        </label>
                                        <textarea id="description" name="description" rows="4" 
                                                  th:text="${room != null ? room.description : ''}" 
                                                  placeholder="Mô tả chi tiết về phòng..."
                                                  class="w-full px-3 py-2 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none form-input resize-none"></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Right Column - Amenities and Images -->
                        <div class="space-y-6">
                            <!-- Amenities -->
                            <div class="bg-gray-50 p-6 rounded-xl">
                                <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                                    <i data-lucide="check-square" class="w-5 h-5 mr-2"></i>
                                    Tiện nghi
                                </h3>
                                
                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                                    <div th:each="amenity : ${T(sd19303no1.hotel_booking_and_management_system.Entity.RoomEntity.Amenity).values()}" 
                                         class="flex items-center space-x-3 p-3 bg-white rounded-lg border border-gray-200 hover:border-purple-300 transition-colors">
                                        <input type="checkbox" 
                                               th:id="'amenity-' + ${amenity.name()}"
                                               th:name="amenities" 
                                               th:value="${amenity.name()}"
                                               th:checked="${room != null and room.amenities != null and room.amenities.contains(amenity.name())}"
                                               class="w-4 h-4 text-purple-600 bg-gray-100 border-gray-300 rounded focus:ring-purple-500 focus:ring-2">
                                        <label th:for="'amenity-' + ${amenity.name()}" 
                                               class="text-sm font-medium text-gray-700 cursor-pointer flex-1">
                                            <i th:class="${amenity.iconClass}" class="mr-2 text-purple-500"></i>
                                            <span th:text="${amenity.description}"></span>
                                        </label>
                                    </div>
                                </div>
                                <p class="text-sm text-gray-500 mt-3">Chọn các tiện nghi có sẵn trong phòng</p>
                            </div>

                            <!-- Images Section -->
                            <div class="bg-gray-50 p-6 rounded-xl">
                                <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                                    <i data-lucide="image" class="w-5 h-5 mr-2"></i>
                                    Ảnh phòng
                                </h3>
                                
                                <!-- Existing Images -->
                                <div th:if="${room != null && room.imageUrls != null && !room.imageUrls.empty}" class="mb-4">
                                    <h4 class="text-md font-medium text-gray-700 mb-3">Ảnh hiện tại</h4>
                                    <div class="grid grid-cols-2 sm:grid-cols-3 gap-3">
                                        <div th:each="img,iter : ${room.imageUrls}" class="relative group">
                                            <img th:src="@{'/img/rooms/' + ${img}}" 
                                                 class="w-full h-24 object-cover rounded-lg border-2 border-gray-200 image-preview" />
                                            <button type="button" 
                                                    class="delete-btn absolute -top-1 -right-1 bg-red-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs opacity-0 group-hover:opacity-100 transition-opacity"
                                                    th:attr="data-index=${iter.index}" 
                                                    onclick="removeExistingImage(this, this.getAttribute('data-index'))"
                                                    title="Xóa ảnh">
                                                <i data-lucide="x" class="w-3 h-3"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                
                                <div th:if="${room == null || room.imageUrls == null || room.imageUrls.empty}" class="mb-4">
                                    <div class="text-center py-6 text-gray-500">
                                        <i data-lucide="image-off" class="w-8 h-8 mx-auto mb-2 text-gray-300"></i>
                                        <p class="text-sm">Chưa có ảnh nào</p>
                                    </div>
                                </div>
                                
                                <!-- Upload New Images -->
                                <div>
                                    <h4 class="text-md font-medium text-gray-700 mb-3">Thêm ảnh mới</h4>
                                    <div class="file-upload-area" id="uploadArea">
                                        <div class="text-center">
                                            <i data-lucide="upload" class="w-8 h-8 mx-auto mb-3 text-gray-400"></i>
                                            <p class="text-sm font-medium text-gray-700 mb-2">Kéo thả ảnh vào đây hoặc click để chọn</p>
                                            <p class="text-xs text-gray-500 mb-3">Hỗ trợ: JPG, PNG, GIF (tối đa 5 ảnh)</p>
                                            <input type="file" id="roomImagesEdit" name="roomImages" multiple accept="image/*" class="custom-file-input">
                                            <button type="button" onclick="document.getElementById('roomImagesEdit').click()" 
                                                    class="bg-purple-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-purple-700 transition-colors text-sm">
                                                Chọn ảnh
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <!-- Image Preview -->
                                    <div id="new-image-preview-edit" class="grid grid-cols-2 sm:grid-cols-3 gap-3 mt-3" style="display: none;"></div>
                                </div>
                                
                                <input type="hidden" id="deletedImagesEdit" name="deletedImages" value="" />
                            </div>
                        </div>
                    </div>

                    <!-- Form Actions -->
                    <div class="flex flex-col sm:flex-row gap-4 pt-6 border-t border-gray-200 mt-6">
                        <button type="submit" class="flex-1 bg-gradient-to-r from-purple-600 to-purple-700 text-white px-8 py-4 rounded-xl font-semibold hover:from-purple-700 hover:to-purple-800 transition-all duration-300 transform hover:-translate-y-1 flex items-center justify-center">
                            <i data-lucide="save" class="w-5 h-5 mr-2"></i>
                            Lưu thay đổi
                        </button>
                        <a th:href="@{/admin/rooms(partnerId=${room != null and room.partner != null ? room.partner.id : selectedPartnerId})}" 
                           class="flex-1 bg-gray-100 text-gray-700 px-8 py-4 rounded-xl font-semibold hover:bg-gray-200 transition-all duration-300 transform hover:-translate-y-1 flex items-center justify-center">
                            <i data-lucide="x" class="w-5 h-5 mr-2"></i>
                            Hủy
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </main>

    <script>
        // Initialize Lucide icons
        lucide.createIcons();
        
        // File upload handling
        const inputEdit = document.getElementById('roomImagesEdit');
        const previewEdit = document.getElementById('new-image-preview-edit');
        const uploadArea = document.getElementById('uploadArea');
        
        if(inputEdit && previewEdit) {
            inputEdit.addEventListener('change', function() {
                previewEdit.innerHTML = '';
                if (this.files.length > 0) {
                    previewEdit.style.display = 'grid';
                    Array.from(this.files).forEach(file => {
                        const reader = new FileReader();
                        reader.onload = e => {
                            const img = document.createElement('img');
                            img.src = e.target.result;
                            img.className = 'w-full h-32 object-cover rounded-xl border-2 border-gray-200 image-preview';
                            previewEdit.appendChild(img);
                        };
                        reader.readAsDataURL(file);
                    });
                } else {
                    previewEdit.style.display = 'none';
                }
            });
        }
        
        // Drag and drop functionality
        if(uploadArea) {
            uploadArea.addEventListener('dragover', function(e) {
                e.preventDefault();
                this.classList.add('dragover');
            });
            
            uploadArea.addEventListener('dragleave', function(e) {
                e.preventDefault();
                this.classList.remove('dragover');
            });
            
            uploadArea.addEventListener('drop', function(e) {
                e.preventDefault();
                this.classList.remove('dragover');
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    inputEdit.files = files;
                    inputEdit.dispatchEvent(new Event('change'));
                }
            });
        }
        
        // Remove existing image
        function removeExistingImage(btn, idx) {
            const imgDiv = btn.parentElement;
            imgDiv.style.display = 'none';
            let deleted = document.getElementById('deletedImagesEdit');
            let val = deleted.value ? deleted.value.split(',') : [];
            val.push(idx);
            deleted.value = val.join(',');
        }
    </script>
</body>
</html> 