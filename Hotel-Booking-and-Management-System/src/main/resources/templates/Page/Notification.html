<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quản lý thông báo - Đặt phòng khách sạn</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
     <link rel="stylesheet"  th:href="@{Css/Notification.css}">
</head>
<body>
    <div th:replace="~{/Layout/narbar}"></div>
    <div class="app-layout">
    <!-- Sidebar -->
    <aside class="sidebar">
        <nav class="sidebar-nav" id="sidebarNav">
            <div class="nav-item active" data-target="notifications-inbox">
                <span class="icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-mail">
                        <rect width="20" height="16" x="2" y="4" rx="2"/>
                        <path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/>
                    </svg>
                </span> Hộp thư thông báo
            </div>
            <div class="nav-item" data-target="notification-settings">
                <span class="icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-settings">
                        <path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.09.21a2 2 0 0 1 0 2.73l-.09.21a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.38a2 2 0 0 0-.73-2.73l-.09-.21a2 2 0 0 1 0-2.73l.09-.21a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/>
                        <circle cx="12" cy="12" r="3"/>
                    </svg>
                </span> Cài đặt thông báo
            </div>
        </nav>
    </aside>

    <!-- Content Area -->
    <main class="content-area">
        <!-- Notification Inbox Section -->
        <div id="notifications-inbox" class="notification-inbox-content active">
            <header class="notification-header">
                <h1>Hộp thư thông báo của bạn</h1>
                <p>Xem tất cả các thông báo mới nhất và quan trọng từ dịch vụ đặt phòng khách sạn của chúng tôi.</p>
            </header>

            <div class="notification-controls">
                <div class="filter-tabs" id="filterTabs">
                    <button class="filter-tab active" data-filter="all">Tất cả</button>
                    <button class="filter-tab" data-filter="unread">Chưa đọc</button>
                    <button class="filter-tab" data-filter="promotions">Ưu đãi</button>
                    <button class="filter-tab" data-filter="important">Quan trọng</button>
                </div>
                <button class="action-button" id="markAllAsReadButton">Đánh dấu tất cả đã đọc</button>
            </div>

            <div class="notification-list-wrapper" id="notificationList">
                <!-- Notifications will be rendered here by JavaScript -->
                <!-- The empty-state div is now a sibling of notification items -->
                <div class="empty-state" id="emptyState">
                    Không có thông báo nào phù hợp với bộ lọc của bạn.
                </div>
            </div>
        </div>

        <!-- Notification Settings Section -->
        <div id="notification-settings" class="notification-settings-content">
            <header class="settings-header">
                <h1>Cài đặt thông báo của bạn</h1>
                <p>Chọn cách bạn muốn nhận thông tin cập nhật về việc đặt phòng và các ưu đãi đặc biệt.</p>
            </header>

            <!-- Phần Thông báo qua Email -->
            <section class="settings-section">
                <div class="settings-section-header">
                    <h2>Thông báo qua Email</h2>
                    <p>Nhận các cập nhật quan trọng và thông tin khuyến mãi qua email.</p>
                </div>
                <form>
                    <div class="checkbox-group">
                        <div class="toggle-switch" data-id="email-booking-confirm" data-name="email-booking-confirm" data-checked="true">
                            <div class="toggle-switch-track"></div>
                            <div class="toggle-switch-thumb"></div>
                        </div>
                        <input type="hidden" id="email-booking-confirm-hidden" name="email-booking-confirm" value="true">
                        <label for="email-booking-confirm">Xác nhận đặt phòng
                            <span>Nhận email xác nhận ngay sau khi đặt phòng thành công.</span>
                        </label>
                    </div>
                    <div class="checkbox-group">
                        <div class="toggle-switch" data-id="email-booking-updates" data-name="email-booking-updates" data-checked="true">
                            <div class="toggle-switch-track"></div>
                            <div class="toggle-switch-thumb"></div>
                        </div>
                         <input type="hidden" id="email-booking-updates-hidden" name="email-booking-updates" value="true">
                        <label for="email-booking-updates">Cập nhật đặt phòng
                            <span>Thông báo về thay đổi lịch trình, hủy phòng hoặc cập nhật trạng thái.</span>
                        </label>
                    </div>
                    <div class="checkbox-group">
                        <div class="toggle-switch" data-id="email-pre-arrival" data-name="email-pre-arrival" data-checked="true">
                            <div class="toggle-switch-track"></div>
                            <div class="toggle-switch-thumb"></div>
                        </div>
                         <input type="hidden" id="email-pre-arrival-hidden" name="email-pre-arrival" value="true">
                        <label for="email-pre-arrival">Thông tin trước khi đến
                            <span>Hướng dẫn nhận phòng, tiện ích khách sạn và thông tin hữu ích khác.</span>
                        </label>
                    </div>
                    <div class="checkbox-group">
                        <div class="toggle-switch" data-id="email-post-stay" data-name="email-post-stay" data-checked="false">
                            <div class="toggle-switch-track"></div>
                            <div class="toggle-switch-thumb"></div>
                        </div>
                        <input type="hidden" id="email-post-stay-hidden" name="email-post-stay" value="false">
                        <label for="email-post-stay">Yêu cầu phản hồi sau lưu trú
                            <span>Mời bạn đánh giá trải nghiệm của mình sau khi trả phòng.</span>
                        </label>
                    </div>
                    <div class="checkbox-group">
                        <div class="toggle-switch" data-id="email-promotions-settings" data-name="email-promotions-settings" data-checked="false">
                            <div class="toggle-switch-track"></div>
                            <div class="toggle-switch-thumb"></div>
                        </div>
                        <input type="hidden" id="email-promotions-settings-hidden" name="email-promotions-settings" value="false">
                        <label for="email-promotions-settings">Ưu đãi và khuyến mãi đặc biệt
                            <span>Nhận thông tin về các chương trình giảm giá và ưu đãi độc quyền.</span>
                        </label>
                    </div>
                    <div class="button-group">
                        <button type="submit" class="button button-primary">Lưu thay đổi</button>
                    </div>
                </form>
            </section>

            <!-- Phần Thông báo qua SMS -->
            <section class="settings-section">
                <div class="settings-section-header">
                    <h2>Thông báo qua SMS</h2>
                    <p>Nhận các thông báo ngắn gọn và kịp thời qua tin nhắn điện thoại.</p>
                </div>
                <form>
                    <div class="checkbox-group">
                        <div class="toggle-switch" data-id="sms-booking-reminders" data-name="sms-booking-reminders" data-checked="true">
                            <div class="toggle-switch-track"></div>
                            <div class="toggle-switch-thumb"></div>
                        </div>
                        <input type="hidden" id="sms-booking-reminders-hidden" name="sms-booking-reminders" value="true">
                        <label for="sms-booking-reminders">Nhắc nhở đặt phòng
                            <span>Nhận tin nhắn nhắc nhở trước ngày nhận phòng và trả phòng.</span>
                        </label>
                    </div>
                    <div class="checkbox-group">
                        <div class="toggle-switch" data-id="sms-urgent-alerts" data-name="sms-urgent-alerts" data-checked="false">
                            <div class="toggle-switch-track"></div>
                            <div class="toggle-switch-thumb"></div>
                        </div>
                        <input type="hidden" id="sms-urgent-alerts-hidden" name="sms-urgent-alerts" value="false">
                        <label for="sms-urgent-alerts">Cảnh báo khẩn cấp
                            <span>Thông báo về các vấn đề khẩn cấp liên quan đến đặt phòng của bạn (ví dụ: thay đổi phòng).</span>
                        </label>
                    </div>
                    <div class="checkbox-group">
                        <div class="toggle-switch" data-id="sms-messages-from-hotel" data-name="sms-messages-from-hotel" data-checked="false">
                            <div class="toggle-switch-track"></div>
                            <div class="toggle-switch-thumb"></div>
                        </div>
                        <input type="hidden" id="sms-messages-from-hotel-hidden" name="sms-messages-from-hotel" value="false">
                        <label for="sms-messages-from-hotel">Tin nhắn từ khách sạn
                            <span>Nhận tin nhắn trực tiếp từ nhân viên khách sạn (ví dụ: phòng đã sẵn sàng).</span>
                        </label>
                    </div>
                    <div class="button-group">
                        <button type="submit" class="button button-primary">Lưu thay đổi</button>
                    </div>
                </form>
            </section>

            <!-- Phần Thông báo đẩy (Push Notifications) / Trong ứng dụng -->
            <section class="settings-section">
                <div class="settings-section-header">
                    <h2>Thông báo trong ứng dụng / Đẩy</h2>
                    <p>Nhận thông báo trực tiếp trên trình duyệt hoặc ứng dụng di động của bạn.</p>
                </div>
                <form>
                    <div class="checkbox-group">
                        <div class="toggle-switch" data-id="push-new-messages" data-name="push-new-messages" data-checked="true">
                            <div class="toggle-switch-track"></div>
                            <div class="toggle-switch-thumb"></div>
                        </div>
                        <input type="hidden" id="push-new-messages-hidden" name="push-new-messages" value="true">
                        <label for="push-new-messages">Tin nhắn mới
                            <span>Thông báo khi có tin nhắn mới từ khách sạn hoặc bộ phận hỗ trợ.</span>
                        </label>
                    </div>
                    <div class="checkbox-group">
                        <div class="toggle-switch" data-id="push-price-drops" data-name="push-price-drops" data-checked="false">
                            <div class="toggle-switch-track"></div>
                            <div class="toggle-switch-thumb"></div>
                        </div>
                        <input type="hidden" id="push-price-drops-hidden" name="push-price-drops" value="false">
                        <label for="push-price-drops">Giảm giá phòng yêu thích
                            <span>Nhận thông báo khi giá phòng bạn đã xem hoặc yêu thích giảm.</span>
                        </label>
                    </div>
                    <div class="checkbox-group">
                        <div class="toggle-switch" data-id="push-local-offers" data-name="push-local-offers" data-checked="false">
                            <div class="toggle-switch-track"></div>
                            <div class="toggle-switch-thumb"></div>
                        </div>
                        <input type="hidden" id="push-local-offers-hidden" name="push-local-offers" value="false">
                        <label for="push-local-offers">Ưu đãi địa phương
                            <span>Thông báo về các ưu đãi nhà hàng, điểm tham quan gần khách sạn.</span>
                        </label>
                    </div>
                    <div class="button-group">
                        <button type="submit" class="button button-primary">Lưu thay đổi</button>
                    </div>
                </form>
            </section>

            <!-- Phần Tùy chọn chung về thông báo -->
            <section class="settings-section">
                <div class="settings-section-header">
                    <h2>Tùy chọn chung</h2>
                    <p>Cài đặt chung áp dụng cho tất cả các loại thông báo.</p>
                </div>
                <form>
                    <div class="checkbox-group">
                        <div class="toggle-switch" data-id="notification-sound" data-name="notification-sound" data-checked="true">
                            <div class="toggle-switch-track"></div>
                            <div class="toggle-switch-thumb"></div>
                        </div>
                        <input type="hidden" id="notification-sound-hidden" name="notification-sound" value="true">
                        <label for="notification-sound">Bật âm thanh thông báo
                            <span>Phát âm thanh khi có thông báo mới (áp dụng cho thông báo đẩy).</span>
                        </label>
                    </div>
                    <div class="checkbox-group">
                        <div class="toggle-switch" data-id="do-not-disturb" data-name="do-not-disturb" data-checked="false">
                            <div class="toggle-switch-track"></div>
                            <div class="toggle-switch-thumb"></div>
                        </div>
                        <input type="hidden" id="do-not-disturb-hidden" name="do-not-disturb" value="false">
                        <label for="do-not-disturb">Chế độ không làm phiền
                            <span>Tạm dừng tất cả thông báo không khẩn cấp trong một khoảng thời gian nhất định.</span>
                        </label>
                    </div>
                    <div class="button-group">
                        <button type="submit" class="button button-primary">Lưu thay đổi</button>
                    </div>
                </form>
            </section>
        </div>
    </main>
</div>

<!-- Notification Detail Modal -->
<div class="modal-overlay" id="notificationModal">
    <div class="modal-content">
        <button class="modal-close-button" id="closeModalButton">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x">
                <path d="M18 6 6 18"/>
                <path d="m6 6 12 12"/>
            </svg>
        </button>
        <h2 class="modal-title" id="modalTitle"></h2>
        <div class="modal-timestamp" id="modalTimestamp"></div>
        <div class="modal-message-container">
            <p class="modal-full-message" id="modalFullMessage"></p>
        </div>
        <div class="modal-actions">
            <button class="button button-secondary" id="closeModalBottomButton">Đóng</button>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- Common Elements ---
        const sidebarNav = document.getElementById('sidebarNav');
        // Update selector to target the direct content divs
        const contentSections = document.querySelectorAll('.notification-inbox-content, .notification-settings-content');

        // --- Notification Inbox Elements ---
        const notificationList = document.getElementById('notificationList'); // Now references notification-list-wrapper
        const filterTabs = document.getElementById('filterTabs');
        const markAllAsReadButton = document.getElementById('markAllAsReadButton');
        const emptyState = document.getElementById('emptyState');

        // --- Notification Modal Elements ---
        const notificationModal = document.getElementById('notificationModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalTimestamp = document.getElementById('modalTimestamp');
        const modalFullMessage = document.getElementById('modalFullMessage');
        const closeModalButton = document.getElementById('closeModalButton');
        const closeModalBottomButton = document.getElementById('closeModalBottomButton');

        // --- Sample Notification Data ---
        let notifications = [
            {
                id: 'n1',
                title: 'Xác nhận đặt phòng thành công!',
                preview: 'Đặt phòng của bạn tại Khách sạn Grand View đã được xác nhận. Mã đặt phòng: #ABC12345.',
                fullMessage: `Kính gửi Quý khách,

Chúng tôi xin trân trọng thông báo đặt phòng của quý khách tại Khách sạn Grand View đã được xác nhận thành công.

Mã đặt phòng của quý khách là: #ABC12345.
Ngày nhận phòng: 15/08/2024
Ngày trả phòng: 18/08/2024
Loại phòng: Deluxe Double
Số lượng khách: 2 người

Vui lòng mang theo mã đặt phòng này khi đến nhận phòng. Nếu có bất kỳ thắc mắc nào, xin vui lòng liên hệ với chúng tôi qua số điện thoại 028-12345678 hoặc email support@hotelgrandview.com.

Chúc quý khách có một kỳ nghỉ tuyệt vời và đáng nhớ tại khách sạn của chúng tôi!`,
                timestamp: '2 phút trước',
                icon: `
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-check-circle">
                        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                        <path d="m9 11 3 3L22 4"/>
                    </svg>
                `,
                read: false,
                type: 'important'
            },
            {
                id: 'n2',
                title: 'Nhắc nhở: Sắp đến ngày nhận phòng!',
                preview: 'Chỉ còn 2 ngày nữa là đến ngày nhận phòng của bạn tại Khách sạn Sunshine. Hãy chuẩn bị hành lý nhé!',
                fullMessage: `Kính gửi Quý khách,

Đây là lời nhắc nhở thân thiện rằng ngày nhận phòng của quý khách tại Khách sạn Sunshine sắp đến.

Ngày nhận phòng dự kiến: 20/08/2024
Địa chỉ khách sạn: 456 Đường XYZ, Quận ABC, TP.HCM
Thời gian nhận phòng: Từ 14:00

Để quá trình nhận phòng diễn ra thuận lợi, quý khách vui lòng chuẩn bị giấy tờ tùy thân (CMND/CCCD hoặc hộ chiếu) và mã đặt phòng.

Nếu có bất kỳ thay đổi nào trong kế hoạch của quý khách, xin vui lòng thông báo cho chúng tôi sớm nhất có thể.

Chúng tôi rất mong được chào đón quý khách và chúc quý khách có một chuyến đi an toàn!`,
                timestamp: '1 giờ trước',
                icon: `
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-bell">
                        <path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"/>
                        <path d="M10.3 21a1.94 1.94 0 0 0 3.4 0"/>
                    </svg>
                `,
                read: false,
                type: 'important'
            },
            {
                id: 'n3',
                title: 'Ưu đãi độc quyền dành cho bạn!',
                preview: 'Giảm giá 15% cho lần đặt phòng tiếp theo của bạn. Sử dụng mã: SUMMERFUN.',
                fullMessage: `Chào mừng quý khách,

Chúng tôi có một ưu đãi đặc biệt dành riêng cho bạn như một lời cảm ơn vì đã là khách hàng thân thiết của chúng tôi!

Giảm giá 15% cho lần đặt phòng tiếp theo của quý khách tại bất kỳ khách sạn nào trong hệ thống của chúng tôi.
Mã khuyến mãi: SUMMERFUN
Thời gian áp dụng: Từ nay đến 30/09/2024

Đừng bỏ lỡ cơ hội khám phá những điểm đến mới với mức giá ưu đãi. Đặt phòng ngay hôm nay trên website của chúng tôi hoặc qua ứng dụng di động!`,
                timestamp: 'Hôm qua lúc 10:30 SA',
                icon: `
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-tag">
                        <path d="M12.586 2H2v10.586a2 2 0 0 0 .586 1.414L14.586 21.414a2 2 0 0 0 2.828 0l7.172-7.172a2 2 0 0 0 0-2.828L14 2.586A2 2 0 0 0 12.586 2z"/>
                        <circle cx="7.5" cy="7.5" r=".5" fill="currentColor"/>
                    </svg>
                `,
                read: false,
                type: 'promotions'
            },
            {
                id: 'n4',
                title: 'Cập nhật chính sách hủy phòng',
                preview: 'Chúng tôi đã cập nhật chính sách hủy phòng để linh hoạt hơn. Vui lòng xem chi tiết.',
                fullMessage: `Kính gửi Quý khách,

Để mang lại sự linh hoạt tối đa cho kế hoạch du lịch của quý khách trong bối cảnh hiện tại, chúng tôi đã cập nhật chính sách hủy phòng.

Các thay đổi chính bao gồm:
- Thời gian hủy miễn phí được kéo dài hơn cho một số loại đặt phòng.
- Tùy chọn thay đổi ngày đặt phòng dễ dàng hơn mà không mất phí trong một số trường hợp.

Vui lòng truy cập trang 'Chính sách' trên website của chúng tôi để xem chi tiết các điều khoản mới nhất.

Chúng tôi luôn nỗ lực để phục vụ quý khách tốt nhất và đảm bảo sự an toàn, thoải mái cho mọi chuyến đi.`,
                timestamp: '2 ngày trước',
                icon: `
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-info">
                        <circle cx="12" cy="12" r="10"/>
                        <path d="M12 16v-4"/>
                        <path d="M12 8h.01"/>
                    </svg>
                `,
                read: true,
                type: 'important'
            },
            {
                id: 'n5',
                title: 'Hãy chia sẻ trải nghiệm của bạn!',
                preview: 'Chúng tôi rất mong nhận được phản hồi của bạn về kỳ nghỉ tại Khách sạn Blue Ocean.',
                fullMessage: `Kính gửi Quý khách,

Chúng tôi hy vọng quý khách đã có một kỳ nghỉ tuyệt vời và đáng nhớ tại Khách sạn Blue Ocean.

Để giúp chúng tôi không ngừng cải thiện chất lượng dịch vụ và mang đến những trải nghiệm tốt hơn trong tương lai, chúng tôi rất mong nhận được phản hồi chân thành của quý khách.

Vui lòng dành vài phút để điền vào biểu mẫu đánh giá ngắn gọn của chúng tôi tại [link đánh giá].
Ý kiến của quý khách là vô cùng quý giá đối với chúng tôi.

Xin chân thành cảm ơn sự hợp tác của quý khách và hy vọng sẽ được chào đón quý khách trở lại trong tương lai gần!`,
                timestamp: '3 ngày trước',
                icon: `
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-star">
                        <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
                    </svg>
                `,
                read: true,
                type: 'promotions'
            },
            {
                id: 'n6',
                title: 'Khám phá ưu đãi mới tại Đà Nẵng!',
                preview: 'Các khách sạn hàng đầu tại Đà Nẵng đang có ưu đãi hấp dẫn cho mùa hè này.',
                fullMessage: `Chào bạn,

Bạn đang tìm kiếm một điểm đến tuyệt vời cho kỳ nghỉ sắp tới? Đà Nẵng đang chờ đón bạn với những ưu đãi khách sạn không thể bỏ lỡ!

Chúng tôi vừa cập nhật danh sách các khách sạn hàng đầu tại Đà Nẵng với mức giá cực kỳ hấp dẫn cho mùa hè này. Từ resort sang trọng đến khách sạn boutique ấm cúng, bạn sẽ tìm thấy lựa chọn hoàn hảo cho mình.

Truy cập ngay để khám phá và đặt phòng: [Link đến trang ưu đãi Đà Nẵng]

Đừng bỏ lỡ cơ hội tận hưởng bãi biển đẹp, ẩm thực phong phú và những trải nghiệm văn hóa độc đáo tại Đà Nẵng!`,
                timestamp: '4 ngày trước',
                icon: `
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-tag">
                        <path d="M12.586 2H2v10.586a2 2 0 0 0 .586 1.414L14.586 21.414a2 2 0 0 0 2.828 0l7.172-7.172a2 2 0 0 0 0-2.828L14 2.586A2 2 0 0 0 12.586 2z"/>
                        <circle cx="7.5" cy="7.5" r=".5" fill="currentColor"/>
                    </svg>
                `,
                read: true,
                type: 'promotions'
            }
        ];

        let currentFilter = 'all'; // Default filter for notification inbox

        // --- Sidebar Navigation Logic ---
        sidebarNav.addEventListener('click', (e) => {
            const targetNav = e.target.closest('.nav-item');
            if (targetNav) {
                // Remove active from all nav items
                document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
                // Add active to clicked nav item
                targetNav.classList.add('active');

                // Hide all content sections
                contentSections.forEach(section => section.classList.remove('active'));

                // Show the target content section
                const targetId = targetNav.dataset.target;
                const targetSection = document.getElementById(targetId);
                if (targetSection) {
                    targetSection.classList.add('active');
                }
            }
        });

        // --- Notification Inbox Functions (re-integrated) ---
        const renderNotifications = (filter) => {
            notificationList.innerHTML = ''; // Clear current list
            let filteredNotifications = [];

            if (filter === 'all') {
                filteredNotifications = notifications;
            } else if (filter === 'unread') {
                filteredNotifications = notifications.filter(n => !n.read);
            } else if (filter === 'promotions') {
                filteredNotifications = notifications.filter(n => n.type === 'promotions');
            } else if (filter === 'important') {
                filteredNotifications = notifications.filter(n => n.type === 'important');
            }

            if (filteredNotifications.length === 0) {
                emptyState.classList.add('active');
            } else {
                emptyState.classList.remove('active');
                filteredNotifications.forEach(notification => {
                    const item = document.createElement('div');
                    item.classList.add('notification-item');
                    if (!notification.read) {
                        item.classList.add('unread');
                    }
                    item.dataset.id = notification.id; // Store ID for lookup

                    item.innerHTML = `
                        <div class="notification-icon">${notification.icon}</div>
                        <div class="notification-content">
                            <div class="notification-title">${notification.title}</div>
                            <div class="notification-message-preview">${notification.preview}</div>
                            <div class="notification-timestamp">${notification.timestamp}</div>
                        </div>
                    `;
                    notificationList.appendChild(item);

                    // Add click listener for each new item
                    item.addEventListener('click', () => openNotificationDetail(notification.id));
                });
            }
            // Re-append empty state after rendering notifications
            notificationList.appendChild(emptyState);
        };

        const openNotificationDetail = (id) => {
            const notification = notifications.find(n => n.id === id);
            if (notification) {
                modalTitle.textContent = notification.title;
                modalTimestamp.textContent = notification.timestamp;
                modalFullMessage.textContent = notification.fullMessage;

                notificationModal.classList.add('active');

                // Mark as read in data and update UI
                if (!notification.read) {
                    notification.read = true;
                    // Find the corresponding DOM element and remove 'unread' class
                    const domItem = document.querySelector(`.notification-item[data-id="${id}"]`);
                    if (domItem) {
                        domItem.classList.remove('unread');
                    }
                }
            }
        };

        // Event listeners for filter tabs
        filterTabs.addEventListener('click', (e) => {
            if (e.target.classList.contains('filter-tab')) {
                document.querySelectorAll('.filter-tab').forEach(tab => tab.classList.remove('active'));
                e.target.classList.add('active');
                currentFilter = e.target.dataset.filter;
                renderNotifications(currentFilter);
            }
        });

        // Event listener for "Mark All as Read" button
        markAllAsReadButton.addEventListener('click', () => {
            notifications.forEach(n => n.read = true);
            renderNotifications(currentFilter);
            alert('Tất cả thông báo đã được đánh dấu là đã đọc!');
        });

        // Modal close buttons
        closeModalButton.addEventListener('click', () => {
            notificationModal.classList.remove('active');
        });

        closeModalBottomButton.addEventListener('click', () => {
            notificationModal.classList.remove('active');
        });

        // Close modal when clicking outside
        notificationModal.addEventListener('click', (e) => {
            if (e.target === notificationModal) {
                notificationModal.classList.remove('active');
            }
        });

        // Close modal with Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && notificationModal.classList.contains('active')) {
                notificationModal.classList.remove('active');
            }
        });

        // Initial render of notification inbox
        renderNotifications(currentFilter);

        // --- Toggle Switch Logic ---
        const toggleSwitches = document.querySelectorAll('.toggle-switch');

        toggleSwitches.forEach(toggle => {
            const hiddenInputId = `${toggle.dataset.id}-hidden`;
            const hiddenInput = document.getElementById(hiddenInputId);

            // Set initial state based on data-checked attribute
            if (toggle.dataset.checked === 'true') {
                toggle.classList.add('checked');
                if (hiddenInput) hiddenInput.value = 'true';
            } else {
                if (hiddenInput) hiddenInput.value = 'false';
            }

            toggle.addEventListener('click', () => {
                const isChecked = toggle.classList.toggle('checked');
                if (hiddenInput) {
                    hiddenInput.value = isChecked ? 'true' : 'false';
                }
                // You can add logic here to save the setting to backend
                console.log(`Setting ${toggle.dataset.name} changed to: ${isChecked}`);
            });
        });
    });
</script>
</body>
</html>
